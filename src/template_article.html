<!-- 
  svg_bg -> main.js creates ands animate an svg
-->
<script type="text/javascript"> 
</script>
<div id="scroll_progress_bar"></div>
<div id="svg_bg"></div>
<style>
#svg_bg{
  position: fixed;
  z-index: -99; 
}
</style>
<script>
  window.rir = (min, max) => Math.floor(Math.random() * (Math.floor(max) - Math.ceil(min) + 1)) + Math.ceil(min);
</script>
<script type="text/javascript"> 
const createSvgBg = async () => { 
    // Create cubes
    const svg1 = document.createElementNS("http://www.w3.org/2000/svg", "svg");
    svg1.setAttribute ("width", "100vw" ); svg1.setAttribute ("height", "100vh" ); 
    Array(rir(15,25)).fill().map( () => {  
        const x = rir(0,200)+'vh'; const y = rir(0,100)+'vh';
        const size = rir(40,80)
        var rect = document.createElementNS("http://www.w3.org/2000/svg", 'rect');
        rect.setAttribute('x', x); rect.setAttribute('y', y);
        rect.setAttribute('height', size); rect.setAttribute('width', size);
        rect.setAttribute('fill', ['red','green','orange', 'blue'][rir(0,3)]);
        svg1.appendChild(rect);
    }) 
    // Animate Cubes
    r = document.getElementById('svg_bg'); r.innerHTML = ''; r.appendChild(svg1) 
    svg1.querySelectorAll('rect').forEach(rect => { 
        let x = parseInt(rect.getAttribute('x').slice(0, -2))
        let y = parseInt(rect.getAttribute('y').slice(0, -2)); 
        rect.animate([ 
            {x: x-rir(0,10)+'vh', y: y-rir(100,125)+'vh'},
            {x: x+rir(0,10)+'vh', y: y+rir(100,125)+'vh'},
        ], { 
            duration: 20000,
            iterations: Infinity,
        }); 
    }); 
}; createSvgBg(); setInterval(createSvgBg,20000) 
</script>

<!-- 
  gradient_bg
-->
<div id="gradient_bg"></div>
<style>
#gradient_bg{
  position: fixed;
  height: 100vh;
  width: 100vw;
	background: linear-gradient(180deg, var(--bg1), var(--bg2));
	background-size: 100% 200%;
	animation: gradient 60s ease infinite; 
  z-index: -99;
}
@keyframes gradient {
	0% {		background-position: 0% 0%;	} 
	50% {	  background-position: 100% 100%;	} 
	100% {	background-position: 0% 0%;	}  
}
</style> 

<style type="text/css">
  body:has(#sitemap:focus-within) { 
    overscroll-behavior-y: contain; /* Prevent drag-refresh */
  } 
  #sitemap{
    position: fixed;
    width: fit-content;
    top: 0;
    left: 0;  
    z-index: 999;
    overflow: hidden;   
    border-radius: .7rem;
    padding: 1rem;
    padding-top: 0px;

    backdrop-filter: blur(2px) saturate(100%);
    -webkit-backdrop-filter: blur(2px) saturate(100%);
    background-color: var(--bg5);
    border-radius: 12px; 
    box-shadow: 5px 0 20px var(--bg4), -5px 0 20px var(--hint-of-light), inset 0px 0 10px var(--hint-of-light);
  }
  @keyframes pulse { 50% { box-shadow: 5px 0 20px var(--hint-of-light), -5px 0 20px var(--bg4), inset 0px 0 10px var(--bg4); } }

  /* hide checkbox, but still expose it to screen readers.*/
  input { position: absolute;  width: 1px; clip: rect(0 0 0 0); overflow: hidden; white-space: nowrap; }

  /* Use Labels to trigger CSS Effects on checkbox checked */
  #toggle-sitemap{ visibility: hidden; }
  #toggle-sitemap:not(:checked) ~ #sitemap { animation: collapse 1s forwards, pulse 6s linear infinite; }
  #toggle-sitemap:checked ~ #sitemap { animation: expand 1s forwards, pulse 6s linear infinite; }
  @keyframes collapse { from { max-height:75vh} to { max-height:3em; } }
  @keyframes expand { to { max-height:75vh } from { max-height:3em; } }

  /* Use Labels to trigger CSS Effects on checkbox checked */
  #sitemap > label {line-height: 3em; width: -webkit-fill-available; display: inline-block; cursor: grab; }
  #sitemap > label > span:nth-child(1){ position:absolute; } 
  #toggle-sitemap:not(:checked) ~ #sitemap > label > span:nth-child(1) { animation: dismiss 1s forwards;  }
  #toggle-sitemap:not(:checked) ~ #sitemap > *:nth-child() { animation: dismiss 1s forwards;  } 
  #toggle-sitemap:checked ~ #sitemap > label > span:nth-child(1) { animation: reveal 500ms forwards;  }
  #toggle-sitemap:not(:checked) ~ #sitemap > *:nth-child() { animation: reveal 1s forwards;  }
  @keyframes reveal {  from {transform:rotate(0deg)} to {transform: rotate(90deg); } }
  @keyframes dismiss { from {transform:rotate(90deg)} to {transform: rotate(0deg); } }
  </style> 
  
  <!-- this checkbox holds state of whether modal is visible or not -->
  <input checked type="checkbox" id="toggle-sitemap">
  <div id="sitemap"> 
    <label for="toggle-sitemap"><span>Hide</span> <span>Show </span>Sitemap</label>
  </div>

  <script>
    const dragTarget = document.querySelector("#sitemap"); 
    let inDrag = false;
    function downFN(e) {
        inDrag = true;
        objInitLeft = dragTarget.offsetLeft; objInitTop = dragTarget.offsetTop;
        dragStartX = e.pageX || e.targetTouches[0].clientX; 
        dragStartY = e.pageY || e.targetTouches[0].clientY; 
    }
    function moveFN(e) {
        if (!inDrag) {return;} 
        e.preventDefault();
        dragToX = e.pageX || e.targetTouches[0].clientX; 
        dragToY = e.pageY || e.targetTouches[0].clientY; 
        dragTarget.style.left = (objInitLeft + dragToX-dragStartX) + "px";
        dragTarget.style.top = (objInitTop + dragToY-dragStartY) + "px";
      } 
    (function() {
      // start = mousepos & objInit = topleft of obj
      var dragStartX, dragStartY, objInitLeft, objInitTop = 0;
      dragTarget.addEventListener("mousedown", downFN );
      document.addEventListener("mousemove", moveFN,{ passive:false });
      document.addEventListener("mouseup", function(e) {inDrag = false}); 
      dragTarget.addEventListener("touchstart", downFN );
      dragTarget.addEventListener("touchmove", moveFN,{ passive:false });
      dragTarget.addEventListener("touchend", function(e) {inDrag = false;});
    }())
  </script>

<style>
  #header{
    /* center and size to header_nav*/
    width: fit-content;
    margin: auto;
  }
  #header_nav{
    padding: 12px;
    text-align: center;
    z-index: 9;
  }
  #header_bg_wrapper{
    position: absolute;
    top:0px;
    width:100%;
    height:100%;   
    filter: drop-shadow(20px 20px 60px #bebebe) drop-shadow(-20px -20px 60px #ffffff); /* https://neumorphism.io/ */
  }
  #header_bg{  
    border-radius: 50px;
    width:100%;
    height:100%;  
    background-color: var(--bg3);
    clip-path: polygon(33% 38%, 0 43%, 0 0, 100% 0, 100% 43%, 66% 38%, 66% 46%, 100% 60%, 100% 100%, 0 100%, 0 60%, 33% 46%);
    animation:spin 2s linear alternate infinite;
    transition-duration: 2s;
  } 
  #header:hover > #header_bg_wrapper > #header_bg{
    clip-path: polygon(0% 15%, 15% 15%, 15% 0%, 85% 0%, 85% 15%, 100% 15%, 100% 85%, 85% 85%, 85% 100%, 15% 100%, 15% 85%, 0% 85%);
  } 
  @keyframes spin{ from{transform:rotate(-2deg);-webkit-transform: rotate(-2deg);} to{transform:rotate(2deg); -webkit-transform:rotate(2deg)} }
  @keyframes wiggle { /*used by intersection observer in main.js*/
    0% {transform: translate(0, 0);}
    50% {transform: translate(5px, 0);}
    100% {transform: translate(0, 0);}
  }
  </style>
<div id='pageTransitioneer'><p>Don't Look! I'm changing!</p></div>
<style>
  #pageTransitioneer {
    position: fixed;
    z-index: 100;
    top: 50%;
    left: 50%;
    height:0%; overflow:hidden;
    transform: translate(-50%, -50%);
    border-radius: 50px;
    background: var(--radial1);
    background-size: 100% 200%; 
    display: flex;
    align-items: center;
    justify-content: center;
  }
  @keyframes pageTransitioneer {
    0% {  height:00px; width:0px; }
    70% { height:100vh; width:100vw;  }
    90% { height:100vh; width:100vw;  }
    100% { height:100vh; width:100vw;  }
  }
</style>
<!-- 
  CONTENT
-->
<div style="height:30px;"></div>
<div id="header">
  <div id="header_nav">
    <h1><a style="cursor: pointer;" href="./">CVMiniGames</a> | <a href="./" id="title"></a></h1>
    <p><a style="cursor: pointer;" href="https://www.cryptovoxels.com/play?coords=N@1447E,1128S">PLAY NOW</a></p>
    <p id="summary"></p>
  </div>
  <span id="header_bg_wrapper"><div id="header_bg"></div></span> 
</div>
<div style="height:30px;"></div>
</div>
<div class='broider' id='articleContent'>
  <div id="outline"></div>
  <div id="content"></div>
</div>
<div id="toc"></div>
<style>
.broider {
    border-image:  url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFQAAABUCAYAAAAcaxDBAAAAAXNSR0IArs4c6QAAAatJREFUeF7t3EuOwjAABFG4XY7M7WAdI9FquSKZuNjaNJ7nJp8R8Hy0j+N4n57yej3biDvP7zEE/dkHQeG3i6CCwgJwnA0VFBaA42zo5aDpsmh2HP4DVov7bugsWHr+agLwegQVFBaA4/JJaXwLpwVsfm8vaCpIOS5oCZamC5qEyvEMOgZuflmUfAVNQuW4oCVYmi5oEirHe9DyBXabLii844IKCgvAcX1D23v7ccE3v9cX1IbCAnCcDV0O9ObHxNZ7vqGCnswFbSsY5gsqKCwAx9lQQWEBOM6GCgoLwHE2VFBYAI6zoYLCAnCcDRUUFoDjbKigsAAcZ0MFhQXgOBsqKCwAx9lQQWEBOM6GCgoLwHE2VFBYAI6zoZeDzn7+c1zgZh/VyV/vnt1BQYdfDhO0ErChFVee3J+UcubWMwSFt19QQWEBOC6flNrLns2/Ty+oDYUF4Dgbejno+ALpmJjG4QWvHpcvmxJYGl9dAF6foILCAnBcbmh7TIUX+G9xgsI7JqigsAAclxuaLovSOLzg1eMEhXdIUEFhATjOf44ICgvAcTZUUFgAjvsAzQksZB+8F2AAAAAASUVORK5CYII=") 28 /  28px / 0 round;
    border-width:  28px;
    border-style:  solid;
}
</style>

<div id="footer">
  <span id="footer_bg_wrapper"><div id="tracer"></div><div id="footer_bg"></div></span> 
</div>

<script>
function generatePath(bars) { 
  const h = 200; const addPath=(x,y)=>`L${Math.round(x*window.w/bars)},${y}`; 
  const path=Array.from({length:bars},(y,x)=>{y=h-(rir(2,5)*40); return addPath(x,y)+addPath(x+1,y)});
  return ("M0,"+h+path.join('')+addPath(bars, h)+"L0," + h + "Z").replace('undefined', '');
}
function updatePath(bars) {
  const d = generatePath(6);
  document.getElementById("tracer").style.offsetPath = "path('"+d+"')"; 
  document.getElementById("footer_bg").style.animation = "none"; //Glitchy animation fix
  // set css var --path2 to --path1's computed value and update --path1 with new path(d)
  const p = getComputedStyle(document.documentElement).getPropertyValue('--path1');
  document.getElementById("footer_bg").style.animation = "clip-path-polygon 15s linear";
  document.documentElement.style.setProperty('--path2', p || "path('"+d+"')");
  document.documentElement.style.setProperty('--path1', "path('"+d+"')");
}

window.w=Math.min(window.innerWidth, 800);
// console.log({w}, window.innerWidth, window.screen.width, window.visualViewport)
updatePath(); setInterval(updatePath,14900);
document.addEventListener('scroll', function() {
  let scrollPercent = (document.documentElement.scrollTop + document.body.scrollTop) / (document.documentElement.scrollHeight - document.documentElement.clientHeight) * 100;
  scrollPercent = (scrollPercent / 100) * 45 + 10;
  document.documentElement.style.setProperty('--change1', scrollPercent+'%' );
  document.documentElement.style.setProperty('--change2', scrollPercent+'%' );
  clearInterval(window.scrollTimer);
  window.scrollTimer = setInterval(() => {
    document.documentElement.style.setProperty('--change1', "0%");
    document.documentElement.style.setProperty('--change2', "100%");
  }, 1500); 
});
</script>

<div style="height:200px"></div>
<p style="padding:10px; text-align:center">Thank you for reading!</p>

<style>
  #footer{
    position:fixed; bottom: 0px; left: 0px; right: 0px; height: 200px;
    width: min(100vw, 800px); z-index: -1;
    margin: auto;
  } 
  #footer_bg_wrapper{
    position: absolute;
    width:100%; height:100%;   
    filter: drop-shadow(20px 20px 60px #bebebe) drop-shadow(-20px -20px 60px #ffffff);
  }
  #footer_bg{
    width:100%; height:100%;
    background: linear-gradient(45deg, rgba(255, 183, 183,.1), var(--hint-of-light), rgba(240, 248, 255,.4));
  } 
</style>
<style>
  /* Move along path 
    md.style.offsetPath = md.style.offsetPath.replace(/1/g, window.innerWidth).replace(/2/g, window.innerHeight)
  */   
  #tracer {
    offset-path: path('M 0 0 L 0 2 L 0 0'); /* Generated path updates this */
    animation: move 15s linear infinite;
    clip-path: path('M27.822 8.205v-2.862h-2.637V2.484h-6.03v2.859h-2.637v2.862h-2.355v-2.862h-2.64V2.484H5.496v2.859H2.859v2.862H.501v5.718h2.358v2.862h2.259v2.859H7.38v2.859h2.637v2.862h3.015v2.859h4.617v-2.859h3.012v-2.862h2.64v-2.859H25.563v-2.859h2.259v-2.862h2.355V8.205z');
    position:absolute; bottom: 160px; z-index:-1;
    width: 30px; height: 50px; 
  }
  @keyframes move {
    0% { offset-distance: var(--change1); background: var(--hint-of-light)}
    25% {background: var(--bg4)}; 50% {background: var(--hint-of-light)}
    75% {background: var(--bg4)} 100% { offset-distance: var(--change2); background: var(--hint-of-light)}
  } 
  @keyframes clip-path-polygon {
    0% { clip-path: var(--path2) }
    10% { clip-path: var(--path1) }
    100% { clip-path: var(--path1) }
  }
</style>