<!-- 
  svg_bg -> main.js creates ands animate an svg
-->
<script type="text/javascript"> 
</script>
<div id="scroll_progress_bar"></div>
<div id="svg_bg"></div>
<style>
#svg_bg{
  position: fixed;
  z-index: -99; 
}
</style>
<script type="text/javascript"> 
const createSvgBg = async () => {
  //
  // distribute the squares nicer.
  // Update the footer svg every 5 seconds.
  // Animate a square along the path
  // get scroll position and animate the svg acordingly
  // 
    // Create cubes
    const svg1 = document.createElementNS("http://www.w3.org/2000/svg", "svg");
    svg1.setAttribute ("width", "100vw" ); svg1.setAttribute ("height", "100vh" );  
    let rir = (min, max) => Math.floor(Math.random() * (Math.floor(max) - Math.ceil(min) + 1)) + Math.ceil(min);
    Array(rir(5,15)).fill().map( () => {  
        const x = rir(0,100)+'vh'; const y = rir(0,100)+'vh';
        const size = rir(40,80)
        var rect = document.createElementNS("http://www.w3.org/2000/svg", 'rect');
        rect.setAttribute('x', x); rect.setAttribute('y', y);
        rect.setAttribute('height', size); rect.setAttribute('width', size);
        rect.setAttribute('fill', ['red','green','orange', 'blue'][rir(0,3)]);
        svg1.appendChild(rect);
    }) 
    // Animate Cubes
    r = document.getElementById('svg_bg'); r.innerHTML = ''; r.appendChild(svg1) 
    svg1.querySelectorAll('rect').forEach(rect => { 
        let x = rect.getAttribute('x')
        let y = parseInt(rect.getAttribute('y').slice(0, -2)); 
        y = (125+y)+'vh';
        rect.animate([ 
            {x: x, y: '-'+y},
            {x: x, y: y},
        ], { 
            duration: 10000,
            iterations: Infinity,
            direction:'alternate', 
        }); 
    }); 
}; createSvgBg(); 
</script>

<!-- 
  gradient_bg
-->
<div id="gradient_bg"></div>
<style>
#gradient_bg{
  position: fixed;
  height: 100vh;
  width: 100vw;
	background: linear-gradient(180deg, var(--bg1), var(--bg2));
	background-size: 100% 200%;
	animation: gradient 60s ease infinite; 
  z-index: -99;
}
@keyframes gradient {
	0% {		background-position: 0% 0%;	} 
	50% {	  background-position: 100% 100%;	} 
	100% {	background-position: 0% 0%;	}  
}
</style> 

<style type="text/css">
  body:has(#sitemap:focus-within) { 
    overscroll-behavior-y: contain; /* Prevent drag-refresh */
  } 
  #sitemap{
    position: fixed;
    width: fit-content;
    top: 0;
    left: 0;  
    z-index: 999;
    overflow: hidden;   
    border-radius: .7rem;
    padding: 1rem;
    padding-top: 0px;

    backdrop-filter: blur(6px) saturate(46%);
    -webkit-backdrop-filter: blur(6px) saturate(46%);
    background-color: var(--b3o);
    border-radius: 12px;
    border: 1px solid rgba(209, 213, 219, 0.3);
    box-shadow: 5px 0 20px var(--bg4), -5px 0 20px var(--hint-of-light), inset 0px 0 10px var(--hint-of-light);
  }
  @keyframes pulse { 50% { box-shadow: 5px 0 20px var(--hint-of-light), -5px 0 20px var(--bg3), inset 0px 0 10px var(--bg4); } }

  /* hide checkbox, but still expose it to screen readers.*/
  input { position: absolute;  width: 1px; clip: rect(0 0 0 0); overflow: hidden; white-space: nowrap; }

  /* Use Labels to trigger CSS Effects on checkbox checked */
  #toggle-sitemap{ visibility: hidden; }
  #toggle-sitemap:not(:checked) ~ #sitemap { animation: collapse 1s forwards, pulse 6s linear infinite; }
  #toggle-sitemap:checked ~ #sitemap { animation: expand 1s forwards, pulse 6s linear infinite; }
  @keyframes collapse { from { max-height:75vh} to { max-height:3em; } }
  @keyframes expand { to { max-height:75vh } from { max-height:3em; } }

  /* Use Labels to trigger CSS Effects on checkbox checked */
  #sitemap > label {line-height: 3em; width: -webkit-fill-available; display: inline-block; cursor: grab; }
  #sitemap > label > span:nth-child(1){ position:absolute; } 
  #toggle-sitemap:not(:checked) ~ #sitemap > label > span:nth-child(1) { animation: dismiss 1s forwards;  }
  #toggle-sitemap:not(:checked) ~ #sitemap > *:nth-child() { animation: dismiss 1s forwards;  } 
  #toggle-sitemap:checked ~ #sitemap > label > span:nth-child(1) { animation: reveal 500ms forwards;  }
  #toggle-sitemap:not(:checked) ~ #sitemap > *:nth-child() { animation: reveal 1s forwards;  }
  @keyframes reveal {  from {transform:rotate(0deg)} to {transform: rotate(90deg); } }
  @keyframes dismiss { from {transform:rotate(90deg)} to {transform: rotate(0deg); } }
  </style> 
  
  <!-- this checkbox holds state of whether modal is visible or not -->
  <input type="checkbox" id="toggle-sitemap">
  <div id="sitemap"> 
    <label for="toggle-sitemap"><span>Hide</span> <span>Show </span>Sitemap</label>
    <caption>Click or Drag</caption>
  </div>

  <script>
    const dragTarget = document.querySelector("#sitemap"); 
    let inDrag = false;
    function downFN(e) {
        inDrag = true;
        objInitLeft = dragTarget.offsetLeft; objInitTop = dragTarget.offsetTop;
        dragStartX = e.pageX || e.targetTouches[0].clientX; 
        dragStartY = e.pageY || e.targetTouches[0].clientY; 
    }
    function moveFN(e) {
        if (!inDrag) {return;} 
        e.preventDefault();
        dragToX = e.pageX || e.targetTouches[0].clientX; 
        dragToY = e.pageY || e.targetTouches[0].clientY; 
        dragTarget.style.left = (objInitLeft + dragToX-dragStartX) + "px";
        dragTarget.style.top = (objInitTop + dragToY-dragStartY) + "px";
      } 
    (function() {
      // start = mousepos & objInit = topleft of obj
      var dragStartX, dragStartY, objInitLeft, objInitTop = 0;
      dragTarget.addEventListener("mousedown", downFN );
      document.addEventListener("mousemove", moveFN,{ passive:false });
      document.addEventListener("mouseup", function(e) {inDrag = false}); 
      dragTarget.addEventListener("touchstart", downFN );
      dragTarget.addEventListener("touchmove", moveFN,{ passive:false });
      dragTarget.addEventListener("touchend", function(e) {inDrag = false;});
    }())
  </script>

<!-- 
  CONTENT
-->
<div style="height:30px"></div>
<div id="header">
  <div id="header_nav" >
    <h1><a  style="cursor: pointer;" href="/">CVMiniGames</a> | <a href="./" id="title"></a></h1>
    <p><a style="cursor: pointer;" target=blank href="https://www.cryptovoxels.com/play?coords=N@1447E,1128S">PLAY NOW</a></p>
    <p id="summary"></p>
  </div>
  <span id="header_bg_wrapper"><div id="header_bg"></div></span> 
</div>
<div style="height:30px"></div>
</div>
<div id='articleContent'>
  <div id="outline"></div>
  <div id="content"></div>
</div>
<div id="toc"></div>

<svg xmlns="http://www.w3.org/2000/svg" style="    bottom: 0;
position: fixed; height:200px; width: -webkit-fill-available">
  <path class="path2" fill="var(--bg3)" fill-opacity="1" 
  d=""></path>
  <defs>
    <linearGradient id="gradient" gradientTransform="rotate(80)">
      <stop offset="0%"   stop-color="rgba(255, 183, 183,.1)"/>
      <stop offset="40%" stop-color="var(--hint-of-light)"/>
      <stop offset="100%" stop-color="rgba(240, 248, 255,.4)"/>
    </linearGradient>
  </defs>
</svg>
<script>
function generatePath(bars, height) {
    const addPath = (b, h) => "L"+b*window.innerWidth/bars +","+h;
    for (let bar = 0; bar <= bars; bar++) {
        let newH = height - Math.ceil(Math.random() * height)
        window.path = (bar==0?'':window.path) + (addPath(bar, newH) + addPath(bar+1, newH));
    }
    return ("M0,"+height+window.path+addPath(bars+1, height)+"L0,"+height+"Z").replace('undefined','');
}
document.querySelector('.path2').setAttribute('d', generatePath(6, 200));
</script>
<style>
path{
  fill : url(#gradient)
}
</style>